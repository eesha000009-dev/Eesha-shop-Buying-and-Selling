<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Verified - Eesha Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <!-- Centralized Supabase initializer -->
    <script src="../js/config/supabase.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
    <!-- Main Container -->
    <div class="w-full max-w-md">
        <!-- Success Card -->
        <div class="bg-white shadow-xl rounded-lg p-8 text-center">
            <!-- Success Icon -->
            <div class="mb-6">
                <i class="fas fa-check-circle text-6xl text-green-500"></i>
            </div>

            <!-- Message -->
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Email Verified Successfully!</h2>
            <p class="text-gray-600 mb-8">Your email has been verified. You can now log in to your seller account.</p>

            <!-- Login Button -->
            <a href="login.html" 
               class="inline-block w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-white bg-[#f0474a] hover:bg-[#e43d40] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#f0474a] text-center">
                Go to Login
            </a>
        </div>
    </div>

    <script>
        // Use centralized Supabase client
        const supabase = window.supabase;

        // Check if there's a pending seller profile to create
        window.addEventListener('load', async () => {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (session?.user) {
                // Check if seller profile exists
                const { data: seller } = await supabase
                    .from('sellers')
                    .select('*')
                    .eq('id', session.user.id)
                    .single();

                if (!seller) {
                    // Try to create seller profile from stored data
                    const sellerData = JSON.parse(localStorage.getItem('pendingSellerData'));
                    if (sellerData) {
                        try {
                            const { error: createError } = await supabase
                                .from('sellers')
                                .insert([{
                                    id: session.user.id,
                                    status: 'active',
                                    ...sellerData
                                }]);

                            if (!createError) {
                                // Clear the pending data after successful creation
                                localStorage.removeItem('pendingSellerData');
                            }
                        } catch (error) {
                            console.error('Error creating seller profile:', error);
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>